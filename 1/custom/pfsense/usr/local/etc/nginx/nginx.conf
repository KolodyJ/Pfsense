
#user  nobody;
worker_processes  1;

# This default error log path is compiled-in to make sure configuration parsing
# errors are logged somewhere, especially during unattended boot when stderr
# isn't normally logged anywhere. This path will be touched on every nginx
# start regardless of error log location configured here. See
# https://trac.nginx.org/nginx/ticket/147 for more info.
#
#error_log  /var/log/nginx/error.log;
#

#pid        logs/nginx.pid;


events {
    worker_connections  1024;
}


http {
    include       mime.types;
    default_type  application/octet-stream;
    add_header X-Frame-Options SAMEORIGIN;
    server_tokens off;

    #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
    #                  '$status $body_bytes_sent "$http_referer" '
    #                  '"$http_user_agent" "$http_x_forwarded_for"';

    #access_log  logs/access.log  main;

    sendfile        off;
    #tcp_nopush     on;

    #keepalive_timeout  0;
    keepalive_timeout  65;

    gzip on;
    gzip_types text/plain text/css text/javascript application/x-javascript text/xml application/xml application/xml+rss application/json;

    server {
	listen 443 ssl;
	listen [::]:443 ssl;

	http2			on;
	ssl_certificate         /var/etc/cert.pem;
	ssl_certificate_key     /var/etc/cert.key;
	ssl_session_timeout     10m;
	keepalive_timeout       70;
	ssl_session_cache       shared:SSL:10m;
	ssl_protocols   TLSv1.2 TLSv1.3;
	ssl_ciphers "EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305";
	ssl_prefer_server_ciphers       on;
	add_header Strict-Transport-Security "max-age=31536000";
	add_header X-Content-Type-Options nosniff;
	ssl_session_tickets off;
#                ssl_dhparam /etc/dh-parameters.4096;


	root "/usr/local/www/web-installer";
	location / {
		index  index.html index.htm;
	}

	location /installer {
	    include /usr/local/etc/nginx/fastcgi_params;
	    fastcgi_pass  127.0.0.1:9000;
	    fastcgi_buffering off;
	    fastcgi_read_timeout 1h;
	    fastcgi_send_timeout 1h;
	}

        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   /usr/local/www/nginx-dist;
        }
    }

    server {
	listen 80;
	listen [::]:80;
	return 301 https://$http_host$request_uri;
    }
}
